# Bitcoin POS System - Complete Setup Guide

This guide will help you set up and run the complete Bitcoin POS system.

## Prerequisites

- **Node.js** 18+ and npm
- **Docker** and Docker Compose (for PostgreSQL)
- **Git** (for cloning the repository)

For mobile app development:
- **Expo CLI** (`npm install -g expo-cli`)
- iOS Simulator (Mac) or Android Emulator

## Quick Start

### 1. Clone and Install

```bash
# Navigate to the project directory
cd bitcoin-pos-system

# Install root dependencies (if using workspaces)
npm install
```

### 2. Backend Setup

```bash
cd backend

# Copy environment file
cp .env.example .env
# Edit .env if needed (defaults should work)

# Start PostgreSQL with Docker
docker-compose up -d

# Install dependencies
npm install

# Generate Prisma client
npm run db:generate

# Run database migrations
npm run db:migrate

# (Optional) Seed database with demo data
npm run db:seed

# Start the backend server
npm run dev
```

Backend will run on `http://localhost:3001`

**Demo Accounts (after seeding):**
- Customer: `customer@example.com` / `password123`
- Vendor: `vendor@example.com` / `password123`

### 3. Vendor Dashboard Setup

```bash
cd vendor-dashboard

# Install dependencies
npm install

# Start development server
npm run dev
```

Dashboard will run on `http://localhost:5173`

### 4. Customer Mobile App Setup

```bash
cd customer-app

# Install dependencies
npm install

# Start Metro bundler
npm start

# Then press 'i' for iOS or 'a' for Android
# Or run: npm run ios / npm run android
```

## Testing the System

### 1. Vendor Flow

1. Open vendor dashboard at `http://localhost:5173`
2. Login with `vendor@example.com` / `password123`
3. Add products in the "Products" section
4. Go to "QR Generator"
5. Add items to cart and generate a QR code

### 2. Customer Flow

1. Open the mobile app
2. Login with `customer@example.com` / `password123`
3. Add funds using a card starting with `4242`
4. Go to "Scan" tab
5. Scan the QR code generated by the vendor
6. Confirm payment

### 3. Credit Card Testing

- **Success**: Cards starting with `4242`
- **Failure**: Any other card number

## Project Structure

```
bitcoin-pos-system/
├── backend/              # Node.js + Express + PostgreSQL
│   ├── src/
│   │   ├── routes/      # API routes
│   │   ├── utils/       # Utilities
│   │   └── index.ts     # Entry point
│   ├── prisma/          # Database schema
│   └── docker-compose.yml
├── vendor-dashboard/    # React + Vite web app
│   └── src/
│       ├── pages/       # Page components
│       └── components/  # UI components
├── customer-app/        # React Native mobile app
│   └── src/
│       ├── screens/     # App screens
│       └── navigation/  # Navigation setup
└── README.md
```

## API Endpoints

### Authentication
- `POST /api/auth/signup` - Create account
- `POST /api/auth/login` - Login

### Customer
- `GET /api/customer/balance` - Get wallet balance
- `POST /api/customer/add-funds-card` - Add funds
- `POST /api/customer/pay` - Pay vendor
- `GET /api/customer/transactions` - Get transactions

### Vendor
- `GET /api/vendor/products` - Get products
- `POST /api/vendor/add-product` - Add product
- `PUT /api/vendor/products/:id` - Update product
- `DELETE /api/vendor/products/:id` - Delete product
- `POST /api/vendor/create-qr-order` - Generate QR code
- `GET /api/vendor/transactions` - Get transactions
- `GET /api/vendor/dashboard/stats` - Get statistics

## Currency System

- **BTC**: Standard Bitcoin unit (8 decimal places)
- **Sbtc**: Scaled Bitcoin unit (2 decimal places)
- **Conversion**: 1 Sbtc = 0.0000001 BTC (1 BTC = 10,000,000 Sbtc)

## Troubleshooting

### Backend Issues

**Database connection errors:**
```bash
# Check if PostgreSQL is running
docker-compose ps

# Restart PostgreSQL
docker-compose restart

# View logs
docker-compose logs postgres
```

**Prisma issues:**
```bash
# Reset database (WARNING: deletes all data)
npm run db:migrate reset

# Regenerate Prisma client
npm run db:generate
```

### Vendor Dashboard Issues

**Port already in use:**
- Change port in `vite.config.ts`

**API connection errors:**
- Check backend is running on port 3001
- Verify `VITE_API_URL` in `.env`

### Mobile App Issues

**Camera permissions:**
- iOS: Check Settings > Privacy > Camera
- Android: Grant permissions when prompted

**Network connection:**
- **iOS Simulator**: Use `localhost` or `127.0.0.1`
- **Android Emulator**: Use `10.0.2.2` instead of `localhost`
- **Physical Device**: Use your computer's IP address (e.g., `192.168.1.100`)

Update `src/utils/api.ts`:
```typescript
const API_URL = __DEV__ 
  ? Platform.OS === 'android' 
    ? 'http://10.0.2.2:3001'
    : 'http://localhost:3001'
  : 'https://your-api-url.com';
```

**Build errors:**
```bash
# Clear Expo cache
expo start -c

# Reinstall dependencies
rm -rf node_modules && npm install
```

## Development Tips

1. **Database Management**: Use Prisma Studio to view/edit data
   ```bash
   cd backend
   npm run db:studio
   ```

2. **API Testing**: Use tools like Postman or curl to test endpoints

3. **Logging**: Backend logs are in the console. Check browser console for frontend errors.

4. **Hot Reload**: Both frontend and mobile app support hot reload during development.

## Production Deployment

### Backend

1. Set production environment variables
2. Build: `npm run build`
3. Run migrations on production database
4. Start with PM2 or similar: `node dist/index.js`

### Vendor Dashboard

1. Build: `npm run build`
2. Serve `dist/` directory with nginx or similar

### Mobile App

1. Build with Expo EAS: `eas build`
2. Or build native projects with `expo run:ios` / `expo run:android`

## License

MIT

